<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (Bootstrap and custom CSS links) ... -->
    <title>BONEMEAL</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body class="progress-body">
    <div id="particles-js2"></div>
<div class="container">
    <h1 class="text-center">Your images are growing...</h1>
    <!-- Display Area -->
        <div id="progress-bar">
            <div id="progress-bar-value"></div>
        </div>
</div>
<!-- JavaScript for interactive elements -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- particles.js lib - https://github.com/VincentGarreau/particles.js -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
    // Function to update the progress bar
    function updateProgress(progress) {
        var progressBar = document.getElementById("progress-bar");
        var progressValue = document.getElementById("progress-value");

        progressValue.style.width = progress + "%";

        if (progress === 100) {
            // Redirect to the result page when progress reaches 100%
            window.location.href = "/ctm_success";
        }
    }

    // Get the task ID from the URL
    var task_id = "{{ task_id }}";

    // Create a WebSocket connection to the Celery task status endpoint
    var socket = new WebSocket("ws://localhost:5000/task_status/" + task_id);

    // Handle WebSocket messages
    socket.onmessage = function(e) {
        var data = JSON.parse(e.data);

        // Update the progress bar based on the task state and progress
        if (data.state === "SUCCESS") {
            updateProgress(100);
        } else if (data.state === "PENDING") {
            updateProgress(0);
        } else {
            updateProgress(data.progress);
        }
    };
</script>
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
<script src="{{ url_for('static', filename='js/particles2.js') }}"></script>
<script src="{{ url_for('static', filename='js/sound.js') }}"></script>
</body>
</html>
